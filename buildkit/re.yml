type: static-library
name: .buildkit

cxx-compile-definitions-public:
  FMT_HEADER_ONLY: 1
  REPROCXX_SHARED: 1

deps:
  - vcpkg:fmt
  - vcpkg:nlohmann-json
  - vcpkg:boost-algorithm
  - vcpkg:boost-exception
  - vcpkg:boost-stacktrace
  - vcpkg:boost-xpressive
  - vcpkg:boost-process
  - vcpkg:ghc-filesystem
  - vcpkg:yaml-cpp
  - vcpkg:magic-enum
  - github:osdeverr/re-ninja@v1.7 [.libtool]
  - github:osdeverr/semverpp@v1.1.5-no-tests [semverpp]

actions:
  - run:
      on: pre-build
      command: ${re-build-version-info-interpreter | python3}
      args: ["build-version-info.py"]

platform.windows:
  cxx-link-deps:
    - shell32.lib

# Fixes building on Apple systems
platform.osx:
  cxx-compile-definitions-public:
    BOOST_STACKTRACE_GNU_SOURCE_NOT_REQUIRED: 1
    _LIBCPP_DISABLE_AVAILABILITY: 1

platform.linux|osx:
  cxx-global-link-deps:
    - dl
    - pthread
